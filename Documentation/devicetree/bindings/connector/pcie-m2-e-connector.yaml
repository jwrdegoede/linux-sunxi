# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/connector/pcie-m2-e-connector.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: PCIe M.2 Mechanical Key E Connector

maintainers:
  - Manivannan Sadhasivam <manivannan.sadhasivam@oss.qualcomm.com>

description:
  A PCIe M.2 E connector node represents a physical PCIe M.2 Mechanical Key E
  connector. Mechanical Key E connectors are used to connect Wireless
  Connectivity devices including combinations of Wi-Fi, BT, NFC to the host
  machine over interfaces like PCIe/SDIO, USB/UART+PCM, and I2C.

properties:
  compatible:
    const: pcie-m2-e-connector

  vpcie3v3-supply:
    description: A phandle to the regulator for 3.3v supply.

  vpcie1v8-supply:
    description: A phandle to the regulator for VIO 1.8v supply.

  ports:
    $ref: /schemas/graph.yaml#/properties/ports
    description: OF graph bindings modeling the interfaces exposed on the
      connector. Since a single connector can have multiple interfaces, every
      interface has an assigned OF graph port number as described below.

    properties:
      port@0:
        $ref: /schemas/graph.yaml#/properties/port
        description: Connector interfaces for Wi-Fi

        properties:
          endpoint@0:
            $ref: /schemas/graph.yaml#/properties/endpoint
            description: PCIe interface

          endpoint@1:
            $ref: /schemas/graph.yaml#/properties/endpoint
            description: SDIO interface

        anyOf:
          - required:
              - endpoint@0
          - required:
              - endpoint@1

      port@1:
        $ref: /schemas/graph.yaml#/properties/port
        description: Connector interfaces for BT

        properties:
          endpoint@0:
            $ref: /schemas/graph.yaml#/properties/endpoint
            description: USB 2.0 interface

          endpoint@1:
            $ref: /schemas/graph.yaml#/properties/endpoint
            description: UART interface

        anyOf:
          - required:
              - endpoint@0
          - required:
              - endpoint@1

      port@2:
        $ref: /schemas/graph.yaml#/properties/port
        description: PCM/I2S interface

      i2c-parent:
        $ref: /schemas/types.yaml#/definitions/phandle
        description: I2C interface

    oneOf:
      - required:
          - port@0

  clocks:
    description: 32.768 KHz Suspend Clock (SUSCLK) input from the host system to
      the M.2 card. Refer, PCI Express M.2 Specification r4.0, sec 3.1.12.1 for
      more details.
    maxItems: 1

  w-disable1-gpios:
    description: GPIO input to W_DISABLE1# signal. This signal is used by the
      system to disable WiFi radio in the M.2 card. Refer, PCI Express M.2
      Specification r4.0, sec 3.1.12.3 for more details.
    maxItems: 1

  w-disable2-gpios:
    description: GPIO input to W_DISABLE2# signal. This signal is used by the
      system to disable WiFi radio in the M.2 card. Refer, PCI Express M.2
      Specification r4.0, sec 3.1.12.3 for more details.
    maxItems: 1

  viocfg-gpios:
    description: GPIO output to IO voltage configuration (VIO_CFG) signal. This
      signal is used by the M.2 card to indicate to the host system that the
      card supports an independent IO voltage domain for the sideband signals.
      Refer, PCI Express M.2 Specification r4.0, sec 3.1.15.1 for more details.
    maxItems: 1

required:
  - compatible
  - vpcie3v3-supply

additionalProperties: false

examples:
  # PCI M.2 Key E connector for Wi-Fi/BT with PCIe/UART interfaces
  - |
    #include <dt-bindings/gpio/gpio.h>

    connector {
        compatible = "pcie-m2-e-connector";
        vpcie3v3-supply = <&vreg_wcn_3p3>;
        vpcie1v8-supply = <&vreg_l15b_1p8>;
        w-disable1-gpios = <&tlmm 117 GPIO_ACTIVE_LOW>;
        w-disable2-gpios = <&tlmm 116 GPIO_ACTIVE_LOW>;

        ports {
            #address-cells = <1>;
            #size-cells = <0>;

            port@0 {
                reg = <0>;
                #address-cells = <1>;
                #size-cells = <0>;

                endpoint@0 {
                    reg = <0>;
                    remote-endpoint = <&pcie4_port0_ep>;
                };
            };

            port@1 {
                reg = <1>;
                #address-cells = <1>;
                #size-cells = <0>;

                endpoint@1 {
                    reg = <1>;
                    remote-endpoint = <&uart14_ep>;
                };
            };
        };
    };
